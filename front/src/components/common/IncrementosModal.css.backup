/* IncrementosModal.css - Estilos adicionales opcionales */

/* ============= MODAL GENERAL ============= */
.incrementos-modal .modal-dialog {
  max-width: 95%;
  margin: 1.75rem auto;
}

.incrementos-modal .modal-body {
  padding: 1.5rem;
}

/* ============= TABS ============= */
.incrementos-modal .nav-tabs {
  border-bottom: 2px solid #009bdc;
  margin-bottom: 1.5rem;
}

.incrementos-modal .nav-tabs .nav-link {
  color: #666;
  border: none;
  border-bottom: 3px solid transparent;
  font-weight: 500;
  transition: all 0.3s ease;
}

.incrementos-modal .nav-tabs .nav-link:hover {
  color: #009bdc;
  border-bottom-color: #009bdc;
  background-color: transparent;
}

.incrementos-modal .nav-tabs .nav-link.active {
  color: #009bdc;
  border-bottom-color: #009bdc;
  background-color: transparent;
  font-weight: 600;
}

/* ============= CARDS ============= */
.incremento-card {
  border-left: 4px solid #ffc107;
  transition: all 0.3s ease;
}

.incremento-card:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

.deposito-card {
  border-left: 4px solid #28a745;
}

.reporte-card {
  border-left: 4px solid #007bff;
}

/* ============= BADGES ============= */
.badge-incremento {
  font-size: 0.9rem;
  padding: 0.4rem 0.8rem;
}

.badge-proveedor {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.badge-pendiente {
  background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.badge-asignado {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

/* ============= LISTA DE DEP√ìSITOS SELECCIONABLES ============= */
.deposito-selectable {
  transition: all 0.2s ease;
  cursor: pointer;
  border-left: 3px solid transparent !important;
}

.deposito-selectable:hover {
  background-color: #f8f9fa !important;
  border-left-color: #009bdc !important;
}

.deposito-selectable.active {
  background-color: #e3f2fd !important;
  border-left-color: #009bdc !important;
  font-weight: 600;
}

/* ============= RESUMEN FINANCIERO ============= */
.resumen-financiero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1.5rem;
  border-radius: 10px;
  margin: 1rem 0;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.resumen-financiero .resumen-item {
  text-align: center;
  padding: 1rem;
}

.resumen-financiero .resumen-label {
  font-size: 0.85rem;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.resumen-financiero .resumen-valor {
  font-size: 1.8rem;
  font-weight: 700;
  margin-top: 0.5rem;
}

.resumen-ganancia {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

/* ============= CARDS DE ESTAD√çSTICAS ============= */
.stat-card {
  border: none;
  border-radius: 10px;
  transition: all 0.3s ease;
  overflow: hidden;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.stat-card-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.stat-card-success {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  color: white;
}

.stat-card-info {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.stat-card-warning {
  background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
  color: white;
}

.stat-card .stat-icon {
  font-size: 2.5rem;
  opacity: 0.3;
  position: absolute;
  right: 10px;
  top: 10px;
}

/* ============= TABLA DE REPORTES ============= */
.reporte-table {
  border-radius: 10px;
  overflow: hidden;
}

.reporte-table thead {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.reporte-table thead th {
  border: none;
  padding: 1rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.85rem;
}

.reporte-table tbody tr {
  transition: all 0.2s ease;
}

.reporte-table tbody tr:hover {
  background-color: #f8f9fa;
  transform: scale(1.01);
}

/* ============= FORMULARIOS ============= */
.form-control:focus,
.form-select:focus {
  border-color: #009bdc;
  box-shadow: 0 0 0 0.2rem rgba(0, 155, 220, 0.25);
}

.form-label {
  font-weight: 600;
  color: #333;
  margin-bottom: 0.5rem;
}

/* ============= BOTONES ============= */
.btn-incrementos {
  border-radius: 8px;
  padding: 0.6rem 1.5rem;
  font-weight: 600;
  transition: all 0.3s ease;
  border: none;
}

.btn-incrementos:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.btn-primary-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-success-gradient {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  color: white;
}

.btn-danger-gradient {
  background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
  color: white;
}

/* ============= ALERTAS ============= */
.alert {
  border-radius: 10px;
  border: none;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.alert-success {
  background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
  color: #155724;
}

.alert-danger {
  background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  color: #721c24;
}

.alert-warning {
  background: linear-gradient(135deg, #fff720 0%, #ffd700 100%);
  color: #856404;
}

.alert-info {
  background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
  color: #0c5460;
}

/* ============= SPINNERS ============= */
.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  border-radius: 10px;
}

/* ============= ANIMACIONES ============= */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in-up {
  animation: fadeInUp 0.5s ease;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.slide-in-right {
  animation: slideInRight 0.4s ease;
}

/* ============= SWITCH DE CONFIGURACI√ìN ============= */
.form-switch .form-check-input {
  width: 3rem;
  height: 1.5rem;
  cursor: pointer;
}

.form-switch .form-check-input:checked {
  background-color: #28a745;
  border-color: #28a745;
}

.form-switch .form-check-input:focus {
  box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

/* ============= TOOLTIP PERSONALIZADO ============= */
.custom-tooltip {
  position: relative;
  display: inline-block;
}

.custom-tooltip .tooltip-text {
  visibility: hidden;
  width: 200px;
  background-color: #333;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.85rem;
}

.custom-tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}



  /* ============= ESTILOS ADICIONALES PARA NUEVAS FUNCIONALIDADES ============= */

/* Alertas con prioridad */
.alerta-urgente {
  border-left: 5px solid #dc3545;
  animation: pulse 2s infinite;
}

.alerta-media {
  border-left: 5px solid #ffc107;
}

.alerta-baja {
  border-left: 5px solid #17a2b8;
}

/* Verificaci√≥n de consistencia */
.verificacion-exitosa {
  background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(150, 230, 161, 0.4);
}

.verificacion-error {
  background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(252, 74, 26, 0.4);
  color: white;
}

/* Historial de eventos */
.evento-timeline {
  position: relative;
  padding-left: 30px;
}

.evento-timeline::before {
  content: '';
  position: absolute;
  left: 10px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
}

.evento-item {
  position: relative;
  margin-bottom: 20px;
}

.evento-item::before {
  content: '‚óè';
  position: absolute;
  left: -24px;
  top: 5px;
  color: #667eea;
  font-size: 20px;
}

/* Progress bars personalizadas */
.progress-ganancia {
  height: 30px;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 15px;
  overflow: hidden;
}

.progress-ganancia .progress-bar {
  background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Cards de ajustes */
.ajuste-card {
  transition: all 0.3s ease;
  border-left: 4px solid #ffc107;
}

.ajuste-card:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Badges con animaci√≥n */
@keyframes badge-pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

.badge-animated {
  animation: badge-pulse 2s infinite;
}

/* Tooltips mejorados */
.tooltip-custom {
  position: relative;
  cursor: help;
}

.tooltip-custom:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  padding: 8px 12px;
  background: #333;
  color: white;
  border-radius: 6px;
  white-space: nowrap;
  z-index: 1000;
  font-size: 0.85rem;
}

/* Responsive adicional */
@media (max-width: 768px) {
  .stat-card {
    margin-bottom: 1rem;
  }

  .resumen-financiero .resumen-valor {
    font-size: 1.2rem;
  }

  .incrementos-modal .modal-body {
    padding: 1rem;
  }
}
  

/* ============= RESPONSIVE ============= */
@media (max-width: 768px) {
  .incrementos-modal .modal-dialog {
    max-width: 100%;
    margin: 0.5rem;
  }

  .resumen-financiero .resumen-valor {
    font-size: 1.4rem;
  }

  .stat-card .stat-icon {
    font-size: 1.8rem;
  }

  .reporte-table {
    font-size: 0.85rem;
  }

  .btn-incrementos {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
}


/* ============= UTILIDADES ============= */
.cursor-pointer {
  cursor: pointer;
}

.text-gradient {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.shadow-soft {
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.shadow-medium {
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
}

.shadow-strong {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.18);
}

.border-gradient {
  border: 2px solid transparent;
  background-image: 
    linear-gradient(white, white), 
    linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  background-origin: border-box;
  background-clip: padding-box, border-box;
}


// ==================== CAMBIOS PARA front/src/components/common/Incrementosmodal.js ====================

// ============= 1. AGREGAR ESTADOS (despu√©s de los estados existentes) =============

const [porcentajeRealMovistar, setPorcentajeRealMovistar] = useState(null);
const [cargandoPorcentaje, setCargandoPorcentaje] = useState(false);

// ============= 2. CORREGIR FUNCI√ìN cargarEstadisticasAlertas =============
// REEMPLAZAR la funci√≥n existente con esta:

const cargarEstadisticasAlertas = async () => {
  try {
    const response = await api.get('/alertas/estadisticas');
    
    // üî• FILTRAR ESTAD√çSTICAS POR PROVEEDOR ACTUAL
    const estadisticasFiltradas = {
      total: alertas.length, // Usar alertas ya filtradas
      porTipo: {
        incrementos: alertas.filter(a => a.tipo === 'incremento_pendiente').length,
        depositos: alertas.filter(a => a.tipo === 'deposito_sin_asignar').length,
        ajustes: alertas.filter(a => a.tipo === 'ajuste_pendiente').length,
        inconsistencias: alertas.filter(a => a.tipo === 'inconsistencia_saldo').length
      },
      porUrgencia: {
        alta: alertas.filter(a => a.urgencia === 'alta').length,
        media: alertas.filter(a => a.urgencia === 'media').length,
        baja: alertas.filter(a => a.urgencia === 'baja').length
      },
      porProveedor: {
        [proveedor]: alertas.length
      }
    };
    
    setEstadisticasAlertas(estadisticasFiltradas);
  } catch (error) {
    console.error('Error al cargar estad√≠sticas:', error);
  }
};

// ============= 3. AGREGAR NUEVA FUNCI√ìN PARA CARGAR PORCENTAJE REAL =============
// Agregar despu√©s de cargarReporteCompleto():

const cargarPorcentajeRealMovistar = async () => {
  if (proveedor !== 'movistar') {
    setPorcentajeRealMovistar(null);
    return;
  }
  
  setCargandoPorcentaje(true);
  try {
    const params = new URLSearchParams({
      startDate: fechaInicio || '2026-02-09',
      endDate: fechaFin || new Date().toISOString().split('T')[0]
    });
    
    const response = await api.get(`/incrementos/movistar/porcentaje-real?${params}`);
    setPorcentajeRealMovistar(response.data);
    
    console.log('üìä Porcentaje Real Movistar:', response.data);
  } catch (error) {
    console.error('Error cargando porcentaje real:', error);
    setPorcentajeRealMovistar(null);
  } finally {
    setCargandoPorcentaje(false);
  }
};

// ============= 4. AGREGAR USEEFFECT PARA AUTO-CARGAR PORCENTAJE =============
// Agregar despu√©s del useEffect existente que carga el reporte:

// NUEVO: Auto-cargar porcentaje real de Movistar
useEffect(() => {
  if (activeTab === 'reportes' && fechaInicio && fechaFin && show) {
    if (proveedor === 'movistar') {
      cargarPorcentajeRealMovistar();
    } else {
      setPorcentajeRealMovistar(null);
    }
  }
}, [fechaInicio, fechaFin, activeTab, show, proveedor]);

// ============= 5. AGREGAR UI PARA MOSTRAR PORCENTAJE REAL =============
// En el tab de reportes, DESPU√âS de las m√©tricas principales (Row con 4 Cards),
// ANTES del "Resumen Financiero", agregar:

{/* ============= AN√ÅLISIS DE RENDIMIENTO MOVISTAR ============= */}
{proveedor === 'movistar' && porcentajeRealMovistar && (
  <Alert variant="info" className="mb-3">
    <Row>
      <Col md={12}>
        <h6 className="mb-3 d-flex align-items-center">
          <FiTrendingUp className="me-2" /> 
          An√°lisis de Rendimiento Movistar
          {cargandoPorcentaje && <Spinner size="sm" className="ms-2" />}
        </h6>
      </Col>
      
      {/* M√©tricas principales */}
      <Col md={3}>
        <div className="text-center p-2 bg-white rounded shadow-sm">
          <small className="text-muted d-block mb-1">Total Invertido</small>
          <h5 className="mb-0 text-danger">
            {formatearMoneda(porcentajeRealMovistar.totalInvertido)}
          </h5>
          <small className="text-muted">
            {porcentajeRealMovistar.cantidadRecargas} recargas
          </small>
        </div>
      </Col>
      
      <Col md={3}>
        <div className="text-center p-2 bg-white rounded shadow-sm">
          <small className="text-muted d-block mb-1">Total Comisiones</small>
          <h5 className="mb-0 text-success">
            {formatearMoneda(porcentajeRealMovistar.totalComisiones)}
          </h5>
          <small className="text-muted">
            Promedio: {formatearMoneda(porcentajeRealMovistar.promedioComision)}
          </small>
        </div>
      </Col>
      
      <Col md={3}>
        <div className="text-center p-2 bg-success bg-opacity-10 rounded shadow-sm">
          <small className="text-muted d-block mb-1">
            <strong>Porcentaje Real de Ganancia</strong>
          </small>
          <h3 className="mb-0 text-success fw-bold">
            {porcentajeRealMovistar.porcentajeRealRedondeado}%
          </h3>
          <small className="text-muted">
            Exacto: {porcentajeRealMovistar.porcentajeReal}%
          </small>
        </div>
      </Col>
      
      <Col md={3}>
        <div className="text-center p-2 bg-white rounded shadow-sm">
          <small className="text-muted d-block mb-1">ROI (Return on Investment)</small>
          <h5 className="mb-0 text-primary">
            {(parseFloat(porcentajeRealMovistar.porcentajeReal) / 100).toFixed(4)}
          </h5>
          <small className="text-muted">
            Por cada $1 invertido
          </small>
        </div>
      </Col>
      
      {/* Detalles por operadora */}
      {porcentajeRealMovistar.detallesPorOperadora && 
       porcentajeRealMovistar.detallesPorOperadora.length > 0 && (
        <Col md={12} className="mt-3">
          <small className="fw-bold text-muted mb-2 d-block">
            üìä Desglose por Operadora:
          </small>
          <div className="table-responsive">
            <Table size="sm" className="mb-0">
              <thead className="table-light">
                <tr>
                  <th className="small">Operadora</th>
                  <th className="small text-end">Recargas</th>
                  <th className="small text-end">Total Invertido</th>
                  <th className="small text-end">Total Comisiones</th>
                  <th className="small text-end">Promedio</th>
                  <th className="small text-end">% Ganancia</th>
                </tr>
              </thead>
              <tbody>
                {porcentajeRealMovistar.detallesPorOperadora.map((op, idx) => (
                  <tr key={idx}>
                    <td className="small">
                      <Badge bg="primary">{op.operadora}</Badge>
                    </td>
                    <td className="small text-end">{op.cantidad}</td>
                    <td className="small text-end text-danger">
                      {formatearMoneda(op.totalValor)}
                    </td>
                    <td className="small text-end text-success fw-bold">
                      {formatearMoneda(op.totalComision)}
                    </td>
                    <td className="small text-end">
                      {formatearMoneda(op.promedioComision)}
                    </td>
                    <td className="small text-end">
                      <Badge 
                        bg={parseFloat(op.porcentaje) >= 7 ? 'success' : 'warning'}
                        className="fw-bold"
                      >
                        {op.porcentaje}%
                      </Badge>
                    </td>
                  </tr>
                ))}
              </tbody>
            </Table>
          </div>
        </Col>
      )}
      
      {/* Explicaci√≥n */}
      <Col md={12} className="mt-3">
        <div className="p-2 bg-light rounded">
          <small className="text-muted">
            <strong>üí° Explicaci√≥n:</strong> {porcentajeRealMovistar.explicacion}
          </small>
          <br />
          <small className="text-muted">
            <strong>üìê F√≥rmula:</strong> {porcentajeRealMovistar.formula}
          </small>
        </div>
      </Col>
    </Row>
  </Alert>
)}

{/* Mensaje si no hay datos */}
{proveedor === 'movistar' && !porcentajeRealMovistar && !cargandoPorcentaje && reporte && (
  <Alert variant="warning" className="mb-3">
    <FiAlertTriangle /> No se pudo cargar el an√°lisis de rendimiento de Movistar. 
    <Button 
      size="sm" 
      variant="outline-warning" 
      className="ms-2"
      onClick={cargarPorcentajeRealMovistar}
    >
      <FiRefreshCw /> Reintentar
    </Button>
  </Alert>
)}

// ============= 6. RESETEAR ESTADO AL CERRAR MODAL =============
// En la funci√≥n resetearEstados(), agregar:

const resetearEstados = () => {
  setActiveTab('alertas');
  setIncrementos([]);
  setSelectedIncremento(null);
  setNuevoDeposito({
    monto: '',
    usuarioId: '',
    tipoDeposito: 'efectivo',
    referencia: '',
    notas: ''
  });
  setDepositosDisponibles([]);
  setDepositosSeleccionados([]);
  setNotasAsignacion('');
  setIncrementoMaximo(0);
  setAlertas([]);
  setEstadisticasAlertas(null);
  setReporte(null);
  setReporteError(null);
  setAlert({ show: false, message: '', variant: '' });
  
  // üî• AGREGAR ESTOS:
  setPorcentajeRealMovistar(null);
  setCargandoPorcentaje(false);
};

// ============= NOTAS IMPORTANTES =============
/*
1. Las funciones cargarEstadisticasAlertas y cargarDatos ya existen,
   solo necesitas REEMPLAZAR cargarEstadisticasAlertas con la nueva versi√≥n.

2. El orden en cargarDatos para el caso 'alertas' debe ser:
   await cargarAlertas(); // ‚≠ê Primero
   await cargarEstadisticasAlertas(); // ‚≠ê Segundo (usa las alertas ya cargadas)
   await cargarIncrementos();

3. El componente UI del porcentaje real debe ir DESPU√âS de las 4 Cards
   de m√©tricas principales, pero ANTES del Card "Resumen Financiero".

4. Los iconos FiTrendingUp, FiAlertTriangle, FiRefreshCw ya est√°n
   importados en el archivo.
*/




// ==================== CAMBIOS FRONTEND CORREGIDOS ====================
// front/src/components/common/Incrementosmodal.js

// ============= 1. REEMPLAZAR LAS 4 CARDS DE M√âTRICAS =============
// Buscar en el tab "reportes" donde dice <Row className="mb-3"> con las 4 Cards
// REEMPLAZAR todo ese Row con este:

{/* ============= M√âTRICAS PRINCIPALES - 4 CARDS MEJORADAS ============= */}
<Row className="mb-3">
  {/* Card 1: Consistencia */}
  <Col md={3}>
    <Card className={`text-center shadow-sm ${reporte.saldos.consistente ? 'stat-card-success' : 'stat-card-warning'}`}>
      <Card.Body className="py-3">
        <div className="fs-1">
          {reporte.saldos.consistente ? <FiCheckCircle /> : <FiAlertTriangle />}
        </div>
        <h6 className="mb-0" style={{ color: 'white' }}>
          {reporte.saldos.consistente ? 'Consistente' : 'Revisar'}
        </h6>
        {!reporte.saldos.consistente && (
          <small style={{ color: 'rgba(255,255,255,0.8)' }}>
            Dif: {formatearMoneda(reporte.saldos.diferencia)}
          </small>
        )}
      </Card.Body>
    </Card>
  </Col>
  
  {/* Card 2: Saldo Actual */}
  <Col md={3}>
    <Card className="text-center shadow-sm stat-card-primary">
      <Card.Body className="py-3">
        <h4 className="mb-0" style={{ color: 'white' }}>
          {formatearMoneda(reporte.saldos.finalReal)}
        </h4>
        <small style={{ opacity: 0.9, color: 'white' }}>Saldo Actual</small>
      </Card.Body>
    </Card>
  </Col>
  
  {/* ‚≠ê Card 3 - CONDICIONAL: Movistar o General */}
  {proveedor === 'movistar' && porcentajeRealMovistar ? (
    // ‚úÖ MOVISTAR: Mostrar Porcentaje del Periodo
    <Col md={3}>
      <Card className="text-center shadow-sm stat-card-success">
        <Card.Body className="py-3">
          <h4 className="mb-0 fw-bold" style={{ color: 'white' }}>
            {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
          </h4>
          <small style={{ opacity: 0.9, color: 'white' }}>% del Periodo</small>
          <div style={{ 
            fontSize: '0.75rem', 
            opacity: 0.9, 
            marginTop: '4px',
            color: 'white'
          }}>
            +{formatearMoneda(porcentajeRealMovistar.totalComisiones)} ganados
          </div>
        </Card.Body>
      </Card>
    </Col>
  ) : (
    // ‚ùå GENERAL: Mostrar Ganancia tradicional
    <Col md={3}>
      <Card className={`text-center shadow-sm ${
        reporte.totales.incrementos === 0 ? 'stat-card-info' : 
        reporte.totales.gananciaReal >= 0 ? 'stat-card-success' : 'stat-card-warning'
      }`}>
        <Card.Body className="py-3">
          {reporte.totales.incrementos === 0 ? (
            <>
              <h4 className="mb-0" style={{ color: 'white' }}>-</h4>
              <small style={{ opacity: 0.9, color: 'white' }}>Sin incrementos</small>
            </>
          ) : (
            <>
              <h4 className="mb-0" style={{ color: 'white' }}>
                {formatearMoneda(reporte.totales.gananciaReal)}
              </h4>
              <small style={{ opacity: 0.9, color: 'white' }}>
                Ganancia ({reporte.totales.porcentajeGanancia.toFixed(2)}%)
              </small>
            </>
          )}
        </Card.Body>
      </Card>
    </Col>
  )}
  
  {/* ‚≠ê Card 4 - CONDICIONAL: Movistar o General */}
  {proveedor === 'movistar' && porcentajeRealMovistar ? (
    // ‚úÖ MOVISTAR: Mostrar Ganancia Potencial si Reinvierte
    <Col md={3}>
      <Card className="text-center shadow-sm stat-card-info">
        <Card.Body className="py-3">
          <h4 className="mb-0" style={{ color: 'white' }}>
            +{formatearMoneda(porcentajeRealMovistar.gananciaPotencial)}
          </h4>
          <small style={{ opacity: 0.9, color: 'white' }}>Si Reinviertes</small>
          <div style={{ 
            fontSize: '0.75rem', 
            opacity: 0.9, 
            marginTop: '4px',
            color: 'white'
          }}>
            @ {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
          </div>
        </Card.Body>
      </Card>
    </Col>
  ) : (
    // ‚ùå GENERAL: Mostrar Recargas
    <Col md={3}>
      <Card className="text-center shadow-sm stat-card-info">
        <Card.Body className="py-3">
          <h4 className="mb-0" style={{ color: 'white' }}>
            {reporte.contadores.recargas}
          </h4>
          <small style={{ opacity: 0.9, color: 'white' }}>Recargas</small>
        </Card.Body>
      </Card>
    </Col>
  )}
</Row>

// ============= 2. PANEL DETALLADO MEJORADO (OPCIONAL - Colocar despu√©s del Row anterior) =============

{/* ============= AN√ÅLISIS DETALLADO MOVISTAR ============= */}
{proveedor === 'movistar' && porcentajeRealMovistar && (
  <Card className="mb-3 shadow-sm border-success">
    <Card.Header className="bg-success bg-opacity-10 border-success">
      <h6 className="mb-0 fw-bold text-success d-flex align-items-center">
        <FiTrendingUp className="me-2" /> 
        An√°lisis del Periodo: {reporte.periodo.fechaInicio.split(' ')[0]} - {reporte.periodo.fechaFin.split(' ')[0]}
      </h6>
    </Card.Header>
    <Card.Body>
      <Row className="g-3">
        {/* Columna 1: Inversi√≥n del Periodo */}
        <Col md={4}>
          <div className="text-center p-3 bg-light rounded h-100">
            <div className="mb-2">
              <Badge bg="danger" className="mb-2" style={{ fontSize: '0.75rem' }}>
                INVERSI√ìN
              </Badge>
            </div>
            <h4 className="text-danger mb-2 fw-bold">
              -{formatearMoneda(porcentajeRealMovistar.totalInvertido)}
            </h4>
            <div className="small text-muted">
              <div className="mb-1">
                <strong>{porcentajeRealMovistar.cantidadRecargas}</strong> recargas realizadas
              </div>
              <div>
                Promedio: <strong>{formatearMoneda(porcentajeRealMovistar.promedioComision)}</strong>/recarga
              </div>
            </div>
          </div>
        </Col>
        
        {/* Columna 2: Ganancia Real del Periodo */}
        <Col md={4}>
          <div className="text-center p-3 bg-success bg-opacity-10 rounded h-100">
            <div className="mb-2">
              <Badge bg="success" className="mb-2" style={{ fontSize: '0.75rem' }}>
                GANANCIA REAL
              </Badge>
            </div>
            <h4 className="text-success mb-2 fw-bold">
              +{formatearMoneda(porcentajeRealMovistar.totalComisiones)}
            </h4>
            <div className="mb-2">
              <Badge bg="success" className="fs-5 fw-bold px-3 py-2">
                {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
              </Badge>
            </div>
            <small className="text-muted">
              Porcentaje ganado en el periodo
            </small>
          </div>
        </Col>
        
        {/* Columna 3: Potencial de Reinversi√≥n */}
        <Col md={4}>
          <div className="text-center p-3 bg-info bg-opacity-10 rounded h-100">
            <div className="mb-2">
              <Badge bg="info" className="mb-2" style={{ fontSize: '0.75rem' }}>
                SI REINVIERTES
              </Badge>
            </div>
            <h4 className="text-info mb-2 fw-bold">
              +{formatearMoneda(porcentajeRealMovistar.gananciaPotencial)}
            </h4>
            <div className="small text-muted">
              <div className="mb-1">
                Total acumulado:
              </div>
              <div>
                <strong className="text-success">
                  {formatearMoneda(porcentajeRealMovistar.totalConReinversion)}
                </strong>
              </div>
            </div>
          </div>
        </Col>
      </Row>
      
      {/* Explicaci√≥n Clara */}
      <Alert variant="info" className="mt-3 mb-0">
        <Row>
          <Col md={12}>
            <small>
              <strong>üí° {porcentajeRealMovistar.simulacionReinversion.explicacion}</strong>
            </small>
          </Col>
        </Row>
      </Alert>
      
      {/* Detalles por Operadora */}
      {porcentajeRealMovistar.detallesPorOperadora && 
       porcentajeRealMovistar.detallesPorOperadora.length > 0 && (
        <>
          <hr className="my-3" />
          <div className="d-flex justify-content-between align-items-center mb-2">
            <small className="fw-bold text-muted">
              üìä Desglose por Operadora
            </small>
            <Badge bg="secondary">
              Periodo Seleccionado
            </Badge>
          </div>
          <div className="table-responsive">
            <Table size="sm" hover className="mb-0">
              <thead className="table-light">
                <tr>
                  <th className="small">Operadora</th>
                  <th className="small text-center">Recargas</th>
                  <th className="small text-end">Invertido</th>
                  <th className="small text-end">Comisiones</th>
                  <th className="small text-center">% Real</th>
                </tr>
              </thead>
              <tbody>
                {porcentajeRealMovistar.detallesPorOperadora.map((op, idx) => (
                  <tr key={idx}>
                    <td className="small">
                      <Badge bg="primary">{op.operadora}</Badge>
                    </td>
                    <td className="small text-center">
                      <Badge bg="secondary">{op.cantidad}</Badge>
                    </td>
                    <td className="small text-end">
                      <span className="text-danger">
                        -{formatearMoneda(op.totalValor)}
                      </span>
                    </td>
                    <td className="small text-end">
                      <span className="text-success fw-bold">
                        +{formatearMoneda(op.totalComision)}
                      </span>
                    </td>
                    <td className="small text-center">
                      <Badge 
                        bg={parseFloat(op.porcentaje) >= 7 ? 'success' : 
                            parseFloat(op.porcentaje) >= 6 ? 'warning' : 'danger'}
                        className="fw-bold"
                      >
                        {op.porcentaje}%
                      </Badge>
                    </td>
                  </tr>
                ))}
                {/* Fila de totales */}
                <tr className="table-light fw-bold">
                  <td className="small">TOTAL</td>
                  <td className="small text-center">
                    <Badge bg="dark">
                      {porcentajeRealMovistar.cantidadRecargas}
                    </Badge>
                  </td>
                  <td className="small text-end text-danger">
                    -{formatearMoneda(porcentajeRealMovistar.totalInvertido)}
                  </td>
                  <td className="small text-end text-success">
                    +{formatearMoneda(porcentajeRealMovistar.totalComisiones)}
                  </td>
                  <td className="small text-center">
                    <Badge bg="success" className="fw-bold">
                      {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
                    </Badge>
                  </td>
                </tr>
              </tbody>
            </Table>
          </div>
        </>
      )}
    </Card.Body>
  </Card>
)}

// ============= 3. MENSAJE SI NO HAY DATOS (Mantener despu√©s del panel) =============

{proveedor === 'movistar' && !porcentajeRealMovistar && !cargandoPorcentaje && reporte && (
  <Alert variant="warning" className="mb-3">
    <FiAlertTriangle /> No se pudo cargar el an√°lisis del periodo. 
    Puede ser que no haya recargas en el rango seleccionado.
    <Button 
      size="sm" 
      variant="outline-warning" 
      className="ms-2"
      onClick={cargarPorcentajeRealMovistar}
    >
      <FiRefreshCw /> Reintentar
    </Button>
  </Alert>
)}

// ============= NOTAS DE IMPLEMENTACI√ìN =============
/*
UBICACI√ìN EN EL C√ìDIGO:

1. Las 4 Cards (Row) van donde actualmente est√°n las m√©tricas principales
   (despu√©s de "REPORTE" y antes de "Resumen Financiero")

2. El Panel Detallado va DESPU√âS de las 4 Cards y ANTES del "Resumen Financiero"

3. El orden correcto es:
   - Controles de fecha
   - 4 Cards de m√©tricas ‚≠ê NUEVO
   - Panel Detallado Movistar ‚≠ê NUEVO (solo si es Movistar)
   - Resumen Financiero (el que ya existe)
   - Tabs de detalles (Incrementos, Dep√≥sitos, Recargas)

RESULTADO VISUAL:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [Fecha Inicio] [Fecha Fin] [Exportar Excel]           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇConsistent‚îÇ  Saldo   ‚îÇ% Periodo   ‚îÇSi Reinviertes ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ    ‚úì     ‚îÇ$15,892.86‚îÇ   7.19%    ‚îÇ   +$7.97      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ          ‚îÇ          ‚îÇ+$110.79 gan‚îÇ @ 7.19%       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  An√°lisis del Periodo: 2026-02-09 - 2026-02-10         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ INVERSI√ìN   ‚îÇ GANANCIA    ‚îÇ SI REINVIERTES       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ -$1,540.00  ‚îÇ +$110.79    ‚îÇ +$7.97               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ 21 recargas ‚îÇ 7.19%       ‚îÇ Total: $118.76       ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
*/






xxxxxxxxxx

// ==================== FRONTEND ACTUALIZADO - MOSTRAR ROI REAL ====================
// front/src/components/common/Incrementosmodal.js

// ============= 1. ESTADOS (mantener los existentes + agregar si faltan) =============

const [porcentajeRealMovistar, setPorcentajeRealMovistar] = useState(null);
const [cargandoPorcentaje, setCargandoPorcentaje] = useState(false);

// ============= 2. FUNCI√ìN PARA CARGAR M√âTRICAS (actualizar si ya existe) =============

const cargarPorcentajeRealMovistar = async () => {
  if (proveedor !== 'movistar') {
    setPorcentajeRealMovistar(null);
    return;
  }
  
  setCargandoPorcentaje(true);
  try {
    const params = new URLSearchParams({
      startDate: fechaInicio,
      endDate: fechaFin
    });
    
    const response = await api.get(`/incrementos/movistar/porcentaje-real?${params}`);
    setPorcentajeRealMovistar(response.data);
    
    console.log('üìä M√©tricas Reales Movistar:', response.data);
  } catch (error) {
    console.error('Error cargando m√©tricas:', error);
    setPorcentajeRealMovistar(null);
  } finally {
    setCargandoPorcentaje(false);
  }
};

// ============= 3. COMPONENTE UI ACTUALIZADO (reemplazar el panel existente) =============

{/* ============= AN√ÅLISIS COMPLETO MOVISTAR ============= */}
{proveedor === 'movistar' && porcentajeRealMovistar && !porcentajeRealMovistar.error && (
  <Card className="mb-3 shadow-sm border-success">
    <Card.Header className="bg-success bg-opacity-10 border-success">
      <h6 className="mb-0 fw-bold text-success d-flex align-items-center justify-content-between">
        <span>
          <FiTrendingUp className="me-2" /> 
          An√°lisis Completo - Periodo: {porcentajeRealMovistar.periodo.inicio} a {porcentajeRealMovistar.periodo.fin}
        </span>
        {cargandoPorcentaje && <Spinner size="sm" />}
      </h6>
    </Card.Header>
    <Card.Body>
      {/* ===== FILA 1: CAPITAL Y SALDOS ===== */}
      <Row className="g-3 mb-3">
        <Col md={3}>
          <div className="text-center p-3 bg-light rounded h-100">
            <small className="text-muted d-block mb-2">üí∞ CAPITAL INICIAL</small>
            <h5 className="mb-1 text-primary">
              {formatearMoneda(porcentajeRealMovistar.capitalInicial)}
            </h5>
            <small className="text-muted d-block">
              Saldo: {formatearMoneda(porcentajeRealMovistar.saldoInicial)}<br/>
              Incrementos: +{formatearMoneda(porcentajeRealMovistar.totalIncrementos)}
            </small>
          </div>
        </Col>
        
        <Col md={3}>
          <div className="text-center p-3 bg-danger bg-opacity-10 rounded h-100">
            <small className="text-muted d-block mb-2">üìâ INVERTIDO</small>
            <h5 className="mb-1 text-danger">
              -{formatearMoneda(porcentajeRealMovistar.totalInvertido)}
            </h5>
            <small className="text-muted d-block">
              {porcentajeRealMovistar.cantidadRecargas} recargas<br/>
              Promedio: {formatearMoneda(porcentajeRealMovistar.promedioComision)}/recarga
            </small>
          </div>
        </Col>
        
        <Col md={3}>
          <div className="text-center p-3 bg-success bg-opacity-10 rounded h-100">
            <small className="text-muted d-block mb-2">‚úÖ COMISIONES</small>
            <h5 className="mb-1 text-success">
              +{formatearMoneda(porcentajeRealMovistar.totalComisionesReales)}
            </h5>
            <small className="text-muted d-block">
              Registradas: {formatearMoneda(porcentajeRealMovistar.comisionesRegistradas)}<br/>
              Calculadas: {formatearMoneda(porcentajeRealMovistar.comisionesCalculadas)}
            </small>
          </div>
        </Col>
        
        <Col md={3}>
          <div className="text-center p-3 bg-info bg-opacity-10 rounded h-100">
            <small className="text-muted d-block mb-2">üíé SALDO FINAL</small>
            <h5 className="mb-1 text-info">
              {formatearMoneda(porcentajeRealMovistar.saldoFinal)}
            </h5>
            <small className="text-muted d-block">
              Despu√©s de todas<br/>las operaciones
            </small>
          </div>
        </Col>
      </Row>
      
      {/* ===== FILA 2: M√âTRICAS PRINCIPALES (DESTACADAS) ===== */}
      <Row className="g-3 mb-3">
        <Col md={6}>
          <div className="text-center p-4 bg-gradient rounded shadow-sm" 
               style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
            <small className="d-block mb-2 text-white opacity-75">
              üìä PORCENTAJE DEL PERIODO
            </small>
            <h2 className="mb-1 fw-bold text-white">
              {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
            </h2>
            <small className="text-white opacity-90 d-block">
              Comisi√≥n promedio por recarga<br/>
              <Badge bg="light" className="text-dark mt-1">
                {porcentajeRealMovistar.porcentajePeriodo}% exacto
              </Badge>
            </small>
          </div>
        </Col>
        
        <Col md={6}>
          <div className={`text-center p-4 rounded shadow-sm ${
            parseFloat(porcentajeRealMovistar.roiReal) >= 0 
              ? 'bg-gradient' 
              : 'bg-gradient'
          }`} style={{
            background: parseFloat(porcentajeRealMovistar.roiReal) >= 0 
              ? 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)'
              : 'linear-gradient(135deg, #eb3349 0%, #f45c43 100%)'
          }}>
            <small className="d-block mb-2 text-white opacity-75">
              üéØ ROI REAL (con reinversi√≥n)
            </small>
            <h2 className="mb-1 fw-bold text-white">
              {parseFloat(porcentajeRealMovistar.roiReal) >= 0 ? '+' : ''}
              {porcentajeRealMovistar.roiRealRedondeado}%
            </h2>
            <small className="text-white opacity-90 d-block">
              Ganancia/P√©rdida neta:<br/>
              <Badge bg="light" className={`mt-1 ${
                parseFloat(porcentajeRealMovistar.gananciaRealNeta) >= 0 
                  ? 'text-success' 
                  : 'text-danger'
              }`}>
                {parseFloat(porcentajeRealMovistar.gananciaRealNeta) >= 0 ? '+' : ''}
                {formatearMoneda(porcentajeRealMovistar.gananciaRealNeta)}
              </Badge>
            </small>
          </div>
        </Col>
      </Row>
      
      {/* ===== EXPLICACI√ìN CLARA ===== */}
      <Alert variant="info" className="mb-3">
        <Row>
          <Col md={12}>
            <h6 className="mb-2">
              <FiInfo className="me-2" />
              Diferencia entre Porcentaje del Periodo y ROI Real:
            </h6>
          </Col>
          <Col md={6}>
            <strong>üìä Porcentaje del Periodo ({porcentajeRealMovistar.porcentajePeriodoRedondeado}%)</strong>
            <p className="mb-0 small">
              Es el porcentaje promedio que ganas por cada recarga. 
              Ejemplo: Si recargas $100, ganas ~${(parseFloat(porcentajeRealMovistar.porcentajePeriodoRedondeado)).toFixed(2)} en comisi√≥n.
            </p>
          </Col>
          <Col md={6}>
            <strong>üéØ ROI Real ({porcentajeRealMovistar.roiRealRedondeado}%)</strong>
            <p className="mb-0 small">
              Es tu ganancia/p√©rdida neta considerando TODO: saldo inicial, incrementos, 
              y el efecto de reinvertir las comisiones. Muestra si realmente ganaste o perdiste dinero.
            </p>
          </Col>
        </Row>
      </Alert>
      
      {/* ===== DESGLOSE POR OPERADORA (DEL PERIODO) ===== */}
      {porcentajeRealMovistar.detallesPorOperadora && 
       porcentajeRealMovistar.detallesPorOperadora.length > 0 && (
        <>
          <hr className="my-3" />
          <div className="d-flex justify-content-between align-items-center mb-2">
            <small className="fw-bold text-muted">
              üìä Desglose por Operadora
            </small>
            <Badge bg="primary">
              Solo periodo: {porcentajeRealMovistar.periodo.inicio} - {porcentajeRealMovistar.periodo.fin}
            </Badge>
          </div>
          <div className="table-responsive">
            <Table size="sm" hover className="mb-0">
              <thead className="table-light">
                <tr>
                  <th className="small">Operadora</th>
                  <th className="small text-center">Recargas</th>
                  <th className="small text-end">Invertido</th>
                  <th className="small text-end">Comisiones</th>
                  <th className="small text-end">Promedio</th>
                  <th className="small text-center">% Real</th>
                </tr>
              </thead>
              <tbody>
                {porcentajeRealMovistar.detallesPorOperadora.map((op, idx) => (
                  <tr key={idx}>
                    <td className="small">
                      <Badge bg="primary">{op.operadora}</Badge>
                    </td>
                    <td className="small text-center">
                      <Badge bg="secondary">{op.cantidad}</Badge>
                      {op.cantidadSinComision > 0 && (
                        <Badge bg="warning" className="ms-1" title="Comisiones calculadas">
                          {op.cantidadSinComision} calc
                        </Badge>
                      )}
                    </td>
                    <td className="small text-end text-danger">
                      -{formatearMoneda(op.totalValor)}
                    </td>
                    <td className="small text-end text-success fw-bold">
                      +{formatearMoneda(op.totalComision)}
                    </td>
                    <td className="small text-end">
                      {formatearMoneda(op.promedioComision)}
                    </td>
                    <td className="small text-center">
                      <Badge 
                        bg={parseFloat(op.porcentaje) >= 7 ? 'success' : 
                            parseFloat(op.porcentaje) >= 6 ? 'warning' : 'danger'}
                        className="fw-bold"
                      >
                        {op.porcentaje}%
                      </Badge>
                    </td>
                  </tr>
                ))}
                {/* Fila de totales */}
                <tr className="table-light fw-bold">
                  <td className="small">TOTAL</td>
                  <td className="small text-center">
                    <Badge bg="dark">
                      {porcentajeRealMovistar.cantidadRecargas}
                    </Badge>
                  </td>
                  <td className="small text-end text-danger">
                    -{formatearMoneda(porcentajeRealMovistar.totalInvertido)}
                  </td>
                  <td className="small text-end text-success">
                    +{formatearMoneda(porcentajeRealMovistar.totalComisionesReales)}
                  </td>
                  <td className="small text-end">
                    {formatearMoneda(porcentajeRealMovistar.promedioComision)}
                  </td>
                  <td className="small text-center">
                    <Badge bg="success" className="fw-bold">
                      {porcentajeRealMovistar.porcentajePeriodoRedondeado}%
                    </Badge>
                  </td>
                </tr>
              </tbody>
            </Table>
          </div>
        </>
      )}
      
      {/* ===== EXPLICACI√ìN DETALLADA ===== */}
      <div className="mt-3 p-3 bg-light rounded">
        <small className="text-muted">
          <strong>üìã Resumen:</strong>
          <pre className="mb-0 mt-2" style={{ fontSize: '0.85rem', whiteSpace: 'pre-wrap' }}>
{porcentajeRealMovistar.explicacion}
          </pre>
        </small>
      </div>
    </Card.Body>
  </Card>
)}

{/* Mensaje si no hay datos */}
{proveedor === 'movistar' && porcentajeRealMovistar?.error && (
  <Alert variant="warning" className="mb-3">
    <FiAlertTriangle /> {porcentajeRealMovistar.error}
  </Alert>
)}

{proveedor === 'movistar' && !porcentajeRealMovistar && !cargandoPorcentaje && reporte && (
  <Alert variant="warning" className="mb-3">
    <FiAlertTriangle /> No se pudo cargar el an√°lisis. 
    <Button 
      size="sm" 
      variant="outline-warning" 
      className="ms-2"
      onClick={cargarPorcentajeRealMovistar}
    >
      <FiRefreshCw /> Reintentar
    </Button>
  </Alert>
)}

// ============= NOTAS DE IMPLEMENTACI√ìN =============
/*
UBICACI√ìN:
- Este componente va DESPU√âS de las 4 Cards de m√©tricas
- Va ANTES del "Resumen Financiero"

CAMBIOS CLAVE:
1. ‚úÖ Muestra ROI REAL con color (verde si positivo, rojo si negativo)
2. ‚úÖ Explica la diferencia entre Porcentaje del Periodo y ROI Real
3. ‚úÖ Desglose por operadora muestra comisiones calculadas
4. ‚úÖ Todo el desglose est√° filtrado por el periodo seleccionado

COLORES:
- Verde: Ganancia positiva
- Rojo: P√©rdida
- Azul/Morado: Informaci√≥n general
*/